<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="task5.css">
    <title>dojo 中間課題</title>
  </head>
  <body>
    <h1><span id="titleLeft">「自分のHPで、APIで取得したデータをもとに。</span>
    <span id="titleRight">最新情報を表示するようなサイトを作りたい」</span></h1>
    <script src="https://js.cybozu.com/axios/v0.27.2/axios.min.js"></script>  
    <table id="addNews">
    </table>
    <script>
      const apiUrl = 'https://54o76ppvn8.execute-api.ap-northeast-1.amazonaws.com/prod/bb-dojo';

      const tablecreator = (day, cate, con, url, targ) => {
        const tr_ele = document.createElement('tr');
        let td_ele = document.createElement('td');
        const url_ele = document.createElement('a');
        td_ele.textContent = day;
        tr_ele.appendChild(td_ele);
        td_ele = document.createElement('td');
        td_ele.textContent = cate;
        switch (cate) {
          case '製品':
            td_ele.id = 'product';
            break;
          case 'IR 情報':
            td_ele.id = 'ir';
            break;
          case '企業情報':
            td_ele.id = 'comparny';
            break;
        }
        tr_ele.appendChild(td_ele);
        td_ele = document.createElement('td');
        url_ele.href = url;
        if (targ === '_self') {
          url_ele.target = '_self';
        } else {
          url_ele.target = '_brank';
        }
        con = strChanger(con);
        url_ele.innerText = con;
        td_ele.appendChild(url_ele);
        tr_ele.appendChild(td_ele);
        addNews.appendChild(tr_ele);
      };

      const strChanger = (str) => {
        const strNum = str.length;
        if (strNum >= 30) {
          str = str.substr(0, 30);
          str += '...';
          return str;
        } else {
          return str;
        }
      };

      axios.get(apiUrl, {
        params: {
          id: 'dojo',
          query: 'order by day desc limit 3',
        }
      })
      .then((reps) => {
        for (let tableDisp = 0; tableDisp < reps.data.length; tableDisp++) {
          const tdday = reps.data[tableDisp].day.value;
          const tdcate = reps.data[tableDisp].category.value;
          const tdcont = reps.data[tableDisp].content.value;
          const tdurl = reps.data[tableDisp].url.value;
          const tdtarget = reps.data[tableDisp].target.value;
          tablecreator(tdday, tdcate, tdcont, tdurl, tdtarget);
        }
      })
      .catch((err) => {
        console.log('エラーが発生しました');
        console.log(err);
      });
    </script>
  </body>
</html>